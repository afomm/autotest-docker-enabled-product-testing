---

- name: System is registered and subscribed
  redhat_subscription:
  args:
    autosubscribe: True
    username: "{{ rhsm.username }}"
    password: "{{ rhsm.password }}"
    rhsm_baseurl: "{{ rhsm.baseurl | default(omit) }}"
    server_hostname: "{{ rhsm.hostname | default(omit) }}"
    server_insecure: "{{ rhsm.insecure | default(omit) }}"
    state: present
  register: result
  when: rhsm.username is defined and
        rhsm.username != [] and
        rhsm.password is defined and
        rhsm.password != []
  until: result | success
  retries: "{{ rhsm_retries | default(omit) }}"
  delay: "{{ rhsm_delay | default(omit) }}"
