---

- hosts: peons:&subscribed:&{{ adept_job }}
  any_errors_fatal: true
  roles:
    - subscribed

- hosts: peons:&partitioned:&{{ adept_job }}
  any_errors_fatal: true
  roles:
    - partitioned

- hosts: peons:&rebooted:&{{ adept_job }}
  any_errors_fatal: true
  roles:
    - rebooted

- hosts: peons:&yumrepos:&{{ adept_job }}
  roles:
    - yumrepos

# TODO: Apply all/most roles by conditional instead
#       of group-membership.  Similar to below.
- hosts: peons:&{{ adept_job }}
  any_errors_fatal: true
  roles:
    - role: lvm
      when: lvg_ops is defined or lvol_ops is defined

    - role: swap_enabled
      when: swap_device is defined

- hosts: peons:&installed:&{{ adept_job }}
  any_errors_fatal: true
  roles:
    - installed

- hosts: peons:&updated:&{{ adept_job }}
  any_errors_fatal: true
  roles:
    - updated

- hosts: peons:&atomic_upgrade:&{{ adept_job }}
  any_errors_fatal: true
  roles:
    - atomic_upgrade

- hosts: peons:rebooted:&{{ adept_job }}
  any_errors_fatal: true
  roles:
    - rebooted

- hosts: peons:&{{ adept_job }}
  any_errors_fatal: true
  roles:
    - peon
    - services

- hosts: peons:rebooted:&{{ adept_job }}
  any_errors_fatal: true
  roles:
    - rebooted
